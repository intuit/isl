<!-- Custom footer scripts -->

<!-- Load Lunr.js library if not already loaded by theme -->
<script>
if (typeof lunr === 'undefined') {
  console.log('Loading Lunr.js...');
  var script = document.createElement('script');
  script.src = 'https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js';
  script.onload = function() {
    console.log('✓ Lunr.js loaded manually');
    initializeSearch();
  };
  document.head.appendChild(script);
} else {
  initializeSearch();
}

function initializeSearch() {
  // Wait for search input to be available
  var searchInput = document.querySelector('.search-input');
  if (!searchInput) {
    setTimeout(initializeSearch, 100);
    return;
  }

  console.log('Initializing search...');
  
  searchInput.addEventListener('keyup', function(e) {
    var searchTerm = e.target.value.trim();
    
    if (searchTerm.length < 2) {
      return;
    }
    
    console.log('Searching for:', searchTerm);
    
    if (typeof idx === 'undefined' || typeof store === 'undefined') {
      console.error('Search index or store not available');
      return;
    }
    
    try {
      var results = idx.search(searchTerm);
      console.log('Found', results.length, 'results');
      
      // Display results
      displaySearchResults(results, store);
    } catch (error) {
      console.error('Search error:', error);
    }
  });
}

function displaySearchResults(results, store) {
  var searchResults = document.querySelector('.results');
  if (!searchResults) {
    console.error('Search results container not found');
    return;
  }
  
  if (results.length === 0) {
    searchResults.innerHTML = '<p>No results found</p>';
    return;
  }
  
  var resultsHtml = '<ul>';
  results.forEach(function(result) {
    var item = store[result.ref];
    resultsHtml += '<li><a href="' + item.url + '"><h3>' + item.title + '</h3>';
    if (item.excerpt) {
      resultsHtml += '<p>' + item.excerpt.substring(0, 150) + '...</p>';
    }
    resultsHtml += '</a></li>';
  });
  resultsHtml += '</ul>';
  
  searchResults.innerHTML = resultsHtml;
}
</script>

<script>
// Debug search functionality
document.addEventListener('DOMContentLoaded', function() {
  // Check if search variables are loaded
  setTimeout(function() {
    if (typeof store !== 'undefined') {
      console.log('✓ Search store loaded with', store.length, 'items');
      if (store.length > 0) {
        console.log('First item:', store[0]);
      }
    } else {
      console.error('✗ Search store not loaded');
    }
    
    if (typeof idx !== 'undefined') {
      console.log('✓ Lunr index loaded');
    } else {
      console.error('✗ Lunr index not loaded');
    }
    
    if (typeof lunr !== 'undefined') {
      console.log('✓ Lunr library loaded');
    } else {
      console.error('✗ Lunr library not loaded');
    }
  }, 1000);
});
</script>
